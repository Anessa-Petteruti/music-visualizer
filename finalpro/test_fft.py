import numpy as np
from fft import freq_samples

SINGLE_WAVE_TEST_FILE = 'wav_files/1000_hz_single.wav'
RAW_SINGLE_WAVE = [
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 30, 50, 40, 60, 21,
    30, 50, 40, 60, 21, 48, 56, 52, 59, 44
]
EXPECTED_SINGLE_WAVE = np.asarray(RAW_SINGLE_WAVE, dtype=np.uint8).tobytes()

FOUR_TONES_TEST_FILE = 'wav_files/four_tones_test.wav'
RAW_FOUR_TONES = [
    59, 13, 9, 21, 17, 59, 17, 9, 13, 32,
    17, 59, 9, 13, 24, 59, 17, 9, 13, 5,
    17, 9, 59, 13, 24, 17, 9, 13, 21, 59,
    59, 31, 22, 41, 50, 41, 59, 22, 13, 50,
    50, 13, 22, 59, 41, 50, 41, 22, 13, 59,
    50, 41, 22, 13, 59, 59, 41, 22, 13, 50,
    41, 13, 22, 59, 50, 59, 41, 22, 13, 50,
    59, 41, 22, 13, 50, 59, 13, 22, 41, 31,
    45, 10, 17, 31, 60, 41, 22, 13, 59, 31,
    17, 9, 5, 24, 59, 59, 41, 22, 31, 13,
    17, 9, 5, 24, 59, 24, 5, 9, 59, 17, 17,
    5, 9, 24, 59, 17, 9, 5, 59, 24, 17, 5,
    9, 24, 59, 17, 5, 9, 59, 24, 24, 5, 9,
    59, 17, 17, 5, 9, 59, 24, 17, 5, 9, 59,
    24, 9, 5, 17, 59, 24, 9, 5, 17, 59, 24,
    24, 5, 9, 59, 17, 17, 59, 9, 5, 1, 17,
    59, 9, 5, 1, 17, 59, 9, 5, 1, 5, 1, 9,
    59, 17, 5, 59, 9, 32, 17, 17, 59, 9, 5,
    1, 5, 59, 9, 32, 17, 59, 50, 22, 13, 41,
    30, 21, 11, 6, 60, 26, 18, 10, 5, 60, 59,
    41, 22, 31, 13, 45, 10, 17, 31, 60, 31,
    45, 17, 10, 60, 31, 10, 17, 45, 60, 31,
    45, 17, 10, 60, 59, 13, 22, 41, 31, 41,
    59, 22, 13, 50, 41, 13, 22, 59, 31, 41,
    13, 22, 59, 31, 41, 22, 59, 13, 31, 41,
    59, 22, 13, 31, 41, 22, 13, 59, 3, 22,
    59, 13, 41, 31, 13, 22, 59, 41, 31, 41,
    13, 22, 59, 31, 22, 13, 59, 41, 31, 41,
    22, 13, 59, 3, 59, 41, 22, 31, 13, 22,
    13, 59, 41, 31, 22, 13, 59, 41, 3, 22,
    13, 41, 59, 31, 41, 13, 22, 59, 31, 22,
    13, 59, 41, 3, 22, 13, 41, 59, 31, 59, 13,
    22, 3, 41, 22, 13, 59, 31, 41, 15, 26, 48,
    37, 60, 37, 15, 26, 48, 60, 15, 37, 4,
    26, 60, 15, 37, 60, 48, 26, 15, 37, 60,
    26, 48, 37, 26, 15, 60, 48, 13, 31, 3,
    59, 50, 48, 15, 60, 37, 26, 15, 37, 60,
    26, 48, 15, 37, 60, 26, 48, 9, 5, 13,
    59, 17, 59, 17, 9, 5, 24, 41, 13, 22,
    31, 59, 59, 24, 9, 21, 17, 48, 15, 26,
    60, 37, 13, 22, 41, 50, 59, 50, 13, 22,
    41, 59, 13, 22, 41, 59, 50, 13, 22, 41,
    59, 50, 50, 13, 22, 59, 41, 13, 22, 41,
    50, 59, 50, 13, 22, 59, 41, 13, 22, 41,
    50, 59, 13, 22, 41, 50, 59, 41, 13, 22,
    50, 59, 13, 22, 41, 50, 59, 41, 13, 22,
    50, 59, 41, 13, 22, 50, 59, 13, 22, 41,
    50, 59, 50, 13, 22, 41, 59, 13, 22, 41,
    50, 59, 50, 13, 22, 41, 59, 41, 22, 13,
    50, 59, 13, 22, 41, 50, 59, 21, 5, 9,
    17, 59, 5, 9, 17, 21, 59, 17, 9, 59, 5,
    21, 21, 5, 9, 17, 59, 5, 19, 32, 46, 60,
    51, 55, 47, 39, 60, 51, 55, 47, 39, 60,
    51, 55, 47, 39, 60
]
EXPECTED_FOUR_TONES = np.asarray(RAW_FOUR_TONES, dtype=np.uint8).tobytes()

def test_fft():
    single_wave_result = freq_samples(SINGLE_WAVE_TEST_FILE)
    # expect length of 150: samples taken every 10ms, song is 3s, taking top 5 frequencies: 10 * 3 * 5 = 150
    assert(len(single_wave_result) == 150)
    for i, value in enumerate(single_wave_result):
        assert(value == EXPECTED_SINGLE_WAVE[i])

    four_tones_result = freq_samples(FOUR_TONES_TEST_FILE)
    # expect length of 550: samples taken every 10ms, song is 11s, taking top 5 frequencies: 10 * 11 * 5 = 550
    assert(len(four_tones_result) == 550)
    for i, value in enumerate(four_tones_result):
        assert(value == EXPECTED_FOUR_TONES[i])

if __name__ == '__main__':
    test_fft()
    print('All Tests Passed')
